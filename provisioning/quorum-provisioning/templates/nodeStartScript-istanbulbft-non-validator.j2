#!/bin/bash
PRIVATE_CONFIG={% if ENABLE_TESSERA %}/nodes/non-validator-node-{{ item }}t/tm.ipc{% elif ENABLE_CONSTELLATION %}/nodes/non-validator-node-{{ item }}/tm.ipc{%else%}ignore{%endif%} nohup {{ BUILD_PATH }}/geth --datadir /nodes/non-validator-node-{{ item }} --nodiscover --gcmode {{ GCMODE }} --rpcvhosts=* --istanbul.blockperiod {{ ISTANBUL_BLOCKPERIOD }} --syncmode {{ SYNCMODE }} --mine --miner.threads {{ NUMBER_OF_MINER_THREADS }} --verbosity {{ LOGGING_VERBOSITY }} --networkid {{ NETWORK_ID }} --allow-insecure-unlock --rpc --rpcaddr 0.0.0.0 --rpcport  {{ RPC_START_PORT + groups['node'].index(inventory_hostname) * 100 + numberOfNodes.results[groups['node'].index(inventory_hostname)].item.number | int + my_idx }} --rpcapi {{ PLUGINS }} --ws --wsaddr 0.0.0.0 --wsport {{ WS_START_PORT + groups['node'].index(inventory_hostname) * 100 + numberOfNodes.results[groups['node'].index(inventory_hostname)].item.number | int + my_idx }} --wsapi {{ PLUGINS }} --wsorigins=* --nat {{ NAT_MODE }} --miner.gastarget {{ GASTARGET }} --miner.gaslimit {{ GASLIMIT }} {% if ENABLE_METRICS %} --metrics --metrics.influxdb --metrics.influxdb.endpoint "http://{{ INFLUX_HOST }}:8086" --metrics.influxdb.database {{ INFLUX_DATABASE }} --metrics.influxdb.username {{ INFLUX_USERNAME }} --metrics.influxdb.password {{ INFLUX_PASSWORD }} --metrics.influxdb.tags non-validator-node-{{ item }}-{{ inventory_hostname }} {% endif %} --emitcheckpoints --rpc.gascap {{ GASCAP }} --rpc.txfeecap {{ TXFEECAP }} --port {{ P2P_START_PORT + groups['node'].index(inventory_hostname) * 100 + numberOfNodes.results[groups['node'].index(inventory_hostname)].item.number | int + my_idx }} --txpool.pricelimit {{ PRICELIMIT }} --txpool.pricebump {{ PRICEBUMP }} --txpool.accountslots {{ ACCOUNTSLOTS }} --txpool.globalslots {{ GLOBALSLOTS }} --txpool.accountqueue {{ ACCOUNTQUEUE }} --txpool.globalqueue {{ GLOBALQUEUE }} --miner.gasprice {{ GASPRICE }} --vm.calltimeout {{ EVM_TIMEOUT }} >> /nodes/non-validator-node-{{ item }}/node.log 2>&1 &
